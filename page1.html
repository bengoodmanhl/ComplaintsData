<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smoothed Radar Chart from JSON</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    body { font-family: sans-serif; background: #f9f9f9; }
    .axisLabel { font-size: 12px; fill: #333; text-anchor: middle; }
    .line { fill-opacity: 0.1; stroke-width: 2px; }
    .circle { fill-opacity: 0.6; }
  </style>


</head>
<body>
<label for="bankSelect">Select up to 4 banks:</label>
<select id="bankSelect" multiple size="6" style="width: 200px;"></select>

<svg width="700" height="700"></svg>
<script>
const url = "https://raw.githubusercontent.com/bengoodmanhl/bengoodmanhl.github.io/refs/heads/main/RadarJSON.json"; // Replace with your actual URL
const width = 700, height = 700;
const radius = Math.min(width, height) / 2 - 100;

const svg = d3.select("svg")
  .attr("viewBox", `0 0 ${width} ${height}`)
  .append("g")
  .attr("transform", `translate(${width / 2}, ${height / 2})`);

// Tooltip
const tooltip = d3.select("body")
  .append("div")
  .attr("class", "tooltip")
  .style("position", "absolute")
  .style("padding", "6px 12px")
  .style("background", "#fff")
  .style("border", "1px solid #999")
  .style("border-radius", "4px")
  .style("box-shadow", "0 2px 4px rgba(0,0,0,0.1)")
  .style("pointer-events", "none")
  .style("opacity", 0);

d3.json(url).then(data => {
  const dimensions = Object.keys(data[0]).filter(d => d !== "name");
  const angleSlice = (2 * Math.PI) / dimensions.length;
  const color = d3.scaleOrdinal(d3.schemeCategory10);

  const extentByDimension = {};
  dimensions.forEach(d => {
    extentByDimension[d] = d3.extent(data, obj => obj[d]);
  });

function getScaledRadius(dimension, value) {
  const rawValue = Math.max(0.1, value); // Clamp minimum to 0.1
  return d3.scaleLinear()
    .domain(extentByDimension[dimension])
    .range([0, 0.9*radius])(rawValue);
}

function updateRadar(selectedNames) {
  // Clear previous radar plots
  svg.selectAll(".series").remove();

  const filteredData = data.filter(d => selectedNames.includes(d.name));

  const group = svg.selectAll(".series")
    .data(filteredData)
    .enter()
    .append("g")
    .attr("class", "series");

  // (same code for path and circles, using radarLine as before)
  group.append("path")
    .attr("class", "line")
    .attr("d", d => {
      const points = dimensions.map((dim, i) => ({
        radius: getScaledRadius(dim, d[dim])
      }));
      return radarLine(points);
    })
    .attr("stroke", d => color(d.name))
    .attr("fill", d => color(d.name))
    .attr("fill-opacity", 0.1)
    .attr("stroke-width", 2);

  group.selectAll(".circle")
    .data(d => dimensions.map((dim, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const r = getScaledRadius(dim, d[dim]);
      return {
        x: Math.cos(angle) * r,
        y: Math.sin(angle) * r,
        color: color(d.name)
      };
    }))
    .enter()
    .append("circle")
    .attr("class", "circle")
    .attr("r", 3)
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("fill", d => d.color);
}

  

  for (let level = 0; level <= 5; level++) {
    const r = radius * (level / 5);
    const points = dimensions.map((_, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      return [Math.cos(angle) * r, Math.sin(angle) * r];
    });
    svg.append("polygon")
      .attr("points", points.map(d => d.join(",")).join(" "))
      .attr("fill", "none")
      .attr("stroke", "#ccc");
  }

  dimensions.forEach((dim, i) => {
    const angle = angleSlice * i - Math.PI / 2;
    const x = Math.cos(angle) * (radius + 20);
    const y = Math.sin(angle) * (radius + 20);
    svg.append("text")
      .attr("class", "axisLabel")
      .attr("x", x)
      .attr("y", y)
      .text(dim);
  });

  const radarLine = d3.lineRadial()
    .radius(d => d.radius)
    .angle((d, i) => i * angleSlice)
    .curve(d3.curveCardinalClosed.tension(0.4));

  const group = svg.selectAll(".series")
    .data(data)
    .enter()
    .append("g")
    .attr("class", "series");

  group.append("path")
    .attr("class", "line")
    .attr("d", d => {
      const points = dimensions.map((dim, i) => ({
        radius: getScaledRadius(dim, d[dim])
      }));
      return radarLine(points);
    })
    .attr("stroke", d => color(d.name))
    .attr("fill", d => color(d.name))
    .attr("fill-opacity", 0.1)
    .attr("stroke-width", 2)


    
.on("mouseover", function(event, d) {
  // Dim all other series
  svg.selectAll(".series")
    .transition().duration(200)
    .style("opacity", 0.1);

  // Highlight current series
  d3.select(this.parentNode)
    .transition().duration(200)
    .style("opacity", 1);

  // Show tooltip
  tooltip.transition().duration(200).style("opacity", 1);
  tooltip.html(`<strong>${d.name}</strong>`)
         .style("left", (event.pageX + 10) + "px")
         .style("top", (event.pageY - 28) + "px");
})
.on("mouseout", function() {
  // Reset all series
  svg.selectAll(".series")
    .transition().duration(300)
    .style("opacity", 1);

  // Hide tooltip
  tooltip.transition().duration(300).style("opacity", 0);
});

  group.selectAll(".circle")
    .data(d => dimensions.map((dim, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const r = getScaledRadius(dim, d[dim]);
      return {
        x: Math.cos(angle) * r,
        y: Math.sin(angle) * r,
        color: color(d.name)
      };
    }))
    .enter()
    .append("circle")
    .attr("class", "circle")
    .attr("r", 3)
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("fill", d => d.color);

// Populate dropdown with bank names
const select = d3.select("#bankSelect");
data.forEach(d => {
  select.append("option")
    .attr("value", d.name)
    .text(d.name);
});

  function updateRadar(selectedNames) {
  svg.selectAll(".series").remove();

  const filteredData = data.filter(d => selectedNames.includes(d.name));

  const group = svg.selectAll(".series")
    .data(filteredData)
    .enter()
    .append("g")
    .attr("class", "series");

  group.append("path")
    .attr("class", "line")
    .attr("d", d => {
      const points = dimensions.map((dim, i) => ({
        radius: getScaledRadius(dim, d[dim])
      }));
      return radarLine(points);
    })
    .attr("stroke", d => color(d.name))
    .attr("fill", d => color(d.name))
    .attr("fill-opacity", 0.1)
    .attr("stroke-width", 2);

  group.selectAll(".circle")
    .data(d => dimensions.map((dim, i) => {
      const angle = angleSlice * i - Math.PI / 2;
      const r = getScaledRadius(dim, d[dim]);
      return {
        x: Math.cos(angle) * r,
        y: Math.sin(angle) * r,
        color: color(d.name)
      };
    }))
    .enter()
    .append("circle")
    .attr("class", "circle")
    .attr("r", 3)
    .attr("cx", d => d.x)
    .attr("cy", d => d.y)
    .attr("fill", d => d.color);
}

  

  

// Watch for changes and update chart
select.on("change", function() {
  const selected = Array.from(this.selectedOptions).map(opt => opt.value);
  updateRadar(selected.slice(0, 4)); // Limit to 4
});





});
</script>

</body>
</html>
